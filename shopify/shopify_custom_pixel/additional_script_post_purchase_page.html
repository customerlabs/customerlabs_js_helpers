<!-- CustomerLabs Tag --><script>!function(t,e,r,c,a,n,s){t.ClAnalyticsObject=a,t[a]=t[a]||[],t[a].methods=["trackSubmit","trackClick","pageview","identify","track"],t[a].factory=function(e){return function(){var r=Array.prototype.slice.call(arguments);return r.unshift(e),t[a].push(r),t[a]}};for(var i=0;i<t[a].methods.length;i++){var o=t[a].methods[i];t[a][o]=t[a].factory(o)};n=e.createElement(r),s=e.getElementsByTagName(r)[0],n.async=1,n.crossOrigin="anonymous",n.src=c,s.parentNode.insertBefore(n,s)}(window,document,"script","//cdn.js.customerlabs.co/{{app_id}}.js","_cl");_cl.SNIPPET_VERSION="1.0.0"</script><!-- End of CustomerLabs Tag -->
<script id="cl_additional_post_purchase_script" type="text/javascript">
    window.clShopifyTrack = function(){
        if (!window.Shopify.wasPostPurchasePageSeen) {
            var order = window.Shopify.order;
            var cltraits = order.customer;
            if(cltraits["email"]){
                var user_traits = {}
                for(var trait in cltraits){
                    if(cltraits[trait]){
                        user_traits[trait] = {
                            "t": "string",
                            "v": cltraits[trait]
                        }
                    }
                }
                var props = {
                    "customProperties": {
                        "user_traits": {
                            "t": "Object",
                            "v": user_traits
                        },
                        "identify_by_email": {
                            "t":"string",
                            "v": cltraits["email"],
                            "ib": true
                        }
                    }
                }
                _cl.identify(props)
            }

        }

        Shopify.on('CheckoutAmended', function(newOrder, previousOrder) {
            var order = newOrder;    
            var cltraits = order.customer;
            if(cltraits["email"]){
                var user_traits = {}
                for(var trait in cltraits){
                    if(cltraits[trait]){
                        user_traits[trait] = {
                            "t": "string",
                            "v": cltraits[trait]
                        }
                    }
                }
                var props = {
                    "customProperties": {
                        "user_traits": {
                            "t": "Object",
                            "v": user_traits
                        },
                        "identify_by_email": {
                            "t":"string",
                            "v": cltraits["email"],
                            "ib": true
                        }
                    }
                }
                _cl.identify(props)
            }  
        });

    }
</script>